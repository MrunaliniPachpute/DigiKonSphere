<div class="userDash-container">
  <h3 class="userDash-title"><%= currentUser.username %>'s Dashboard</h3>

  <!-- CART SECTION -->
  <div class="userDash-section">
    <h4 class="userDash-section-title"><span class="cart-icon"><i class="fa-solid fa-cart-shopping"></i></span> My Cart</h4>
    <div class="cart-items">
    <% if (cart && cart.length > 0) { %>
      <% cart.forEach(item => { %>
        <div class="userDash-horizontal-card">
          <div class="userDash-left">
            <div>
              <img src="<%= item.product.image %>" alt="<%= item.product.name %>">
            <a href="/product/<%= item.product._id  %>" class="userDash-name"><%= item.product.name %></a>
            </div>
          </div>
          <div class="userDash-right">
            <p><strong>Price:</strong> ₹<%= item.product.price %></p>
            <p><strong>Quantity:</strong> <%= item.quantity %></p>
            <div class="userDash-btn-group-h">
              <a class="userDash-btn-order" href="/user/product/<%= item.product._id %>/addOrder">Order</a>
              <a class="userDash-btn-remove" href="/user/cart/remove/<%= item.product._id %>">Remove</a>
            </div>
          </div>
        </div>
      <% }) %>
    <% } else { %>
      <p class="userDash-empty">Your cart is empty.</p>
    <% } %>
    </div>
  </div>

 <!-- ORDERS -->
  <!-- ACTIVE ORDERS SECTION -->
<div class="userDash-section">
  <h4 class="userDash-section-title">
    <span class="order-icon"><i class="fa-solid fa-truck"></i></span> Active Orders
  </h4>
  <div class="cart-items">
    <% let activeOrders = orders.filter(o => o.status === "Pending" || o.status === "Shipped"); %>
    <% if (activeOrders.length > 0) { %>
      <% activeOrders.forEach(order => { %>
        <% order.items.forEach(item => { %>
          <div class="userDash-horizontal-card">
            <div class="userDash-left">
              <img src="<%= item.product.image %>" alt="<%= item.product.name %>">
              <a href="/product/<%= item.product._id  %>" class="userDash-name"><%= item.product.name %></a>
            </div>
            <div class="userDash-right">
              <p><strong>Price:</strong> ₹<%= item.priceAtPurchase %></p>
              <p><strong>Quantity:</strong> <%= item.quantity %></p>
              <p><strong>Status:</strong> <span class="order-status"><%= order.status %></span></p>
              <p><strong>Payment:</strong> <%= order.paymentStatus %></p>
              <div class="userDash-btn-group-h">
                <a class="userDash-btn-order" href="/user/order/track/<%= order.trackingId %>">Track</a>
                <a class="userDash-btn-remove" href="/user/order/cancelOrder/<%= order._id %>">Cancel</a>
              </div>
            </div>
          </div>
        <% }) %>
      <% }) %>
    <% } else { %>
      <p class="userDash-empty">No active orders.</p>
    <% } %>
  </div>
</div>

<!-- PAST ORDERS SECTION -->
<div class="userDash-section">
  <h4 class="userDash-section-title">
    <span class="order-icon"><i class="fa-solid fa-box-archive"></i></span> Past Orders
  </h4>
  <div class="cart-items">
    <% let pastOrders = orders.filter(o => o.status === "Delivered" || o.status === "Cancelled"); %>
    <% if (pastOrders.length > 0) { %>
      <% pastOrders.forEach(order => { %>
        <% order.items.forEach(item => { %>
          <div class="userDash-horizontal-card">
            <div class="userDash-left">
              <img src="<%= item.product.image %>" alt="<%= item.product.name %>">
              <a href="/product/<%= item.product._id  %>" class="userDash-name"><%= item.product.name %></a>
            </div>
            <div class="userDash-right">
              <p><strong>Price:</strong> ₹<%= item.priceAtPurchase %></p>
              <p><strong>Quantity:</strong> <%= item.quantity %></p>
              <p><strong>Status:</strong> <span class="order-status"><%= order.status %></span></p>
            </div>
          </div>
        <% }) %>
      <% }) %>
    <% } else { %>
      <p class="userDash-empty">No past orders.</p>
    <% } %>
  </div>
</div>

<!-- DELETE ACCOUNT SECTION -->
<div class="delete-account-section text-center mt-5">
  <form id="deleteAccountForm" action="/user/deleteAccount" method="POST">
    <button type="button" id="deleteAccountBtn" class="prod-del-btn" 
      style="border: none; background-color: rgb(231, 58, 58); color: white; padding: 10px 20px; border-radius: 8px; font-weight: 600;">
      Delete My Account
    </button>
  </form>
</div>

<script>
  document.getElementById("deleteAccountBtn").addEventListener("click", function (e) {
    Swal.fire({
      title: "Are you sure?",
      text: "Your account and all related data (orders, cart, etc.) will be permanently deleted!",
      icon: "warning",
      showCancelButton: true,
      confirmButtonText: "Yes, Delete it",
      cancelButtonText: "Cancel",
      confirmButtonColor: "#e73a3a",
      cancelButtonColor: "#6c757d",
      reverseButtons: true,
    }).then((result) => {
      if (result.isConfirmed) {
        document.getElementById("deleteAccountForm").submit();
      }
    });
  });
</script>


</div>
