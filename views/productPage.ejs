<div class="prod-detail-section" style="display: flex; flex-direction: column; align-items: center; justify-content: center;">
  <div class="prod-detail-card">
    <div class="prod-detail-img">
      <img src="<%= product.image %>" alt="<%= product.name %>" />
    </div>

    <div class="prod-detail-info">

      <div class="ProdTopBtns">
        <div class="btn-container">
          <a href="/product/3dPreview/<%= product._id %>" class=" tryon-btn">3D Preview Mode</a>
          <!-- tryon3dbtn Preview3dbtn-container-->
        </div>

        <div class="btn-container">
          <a href="/artisian/<%= product.owner._id %>/story" class="tryon-btn">Meet the Hands Behind This Art</a>
        </div>

        <div class="btn-container">
          <a href="/product/tryOn/<%= product._id %>" class="tryon-btn">Try On</a>
        </div>
      </div>

      <h2>
        <%= product.name %>
      </h2>
      <p class="prod-detail-price">â‚¹<%= product.price %>
      </p>
      <p>
        <strong>Available Quantity:</strong>
        <%= product.quantity %>
      </p>
      <p>
        <strong>Seller:</strong>
        <%= product.owner.username %>
      </p>

      <% if (product.details && product.details.trim() !=="" ) { %>
        <div class="prod-detail-desc">
          <h4>About this Product:</h4>
          <p>
            <%= product.details %>
          </p>

          <% if (product.owner && product.owner.street) { %>
            <div class="prod-detail-desc">
              <p>
                <strong>Location: </strong>
                <%= product.owner.street || '' %>, <%= product.owner.city || '' %>, <%= product.owner.state || '' %>,
                      <%= product.owner.country || '' %> - <%= product.owner.pincode || '' %>
              </p>
            </div>
            <% } %>
        </div>
        <% } %>
          <% if (product.owner && product.owner.contact) { %>
            <p>
              <strong>Contact Number:</strong>
              <%= product.owner.contact %>
            </p>
            <% } %>

              <a href="/home" class="prod-back-btn"><span style="color: rgb(255, 255, 255)"><i
                    class="fa-solid fa-backward-step"></i></span>
                Back to Market</a>

              <% if(!currentUser || (currentUser && product.owner._id.toString() !==currentUser._id.toString())) {%>

                <% if(product.quantity>0){ %>
                  <a class="prod-edit-btn" href="/product/<%= product._id %>/addToCart">Add to cart</a>
                  <% }else{ %>
                    <button disabled class="out-of-stock-btn">out of stock</button>
                    <% } %>

                      <% } %>
                        <% if(currentUser && product.owner._id.toString()===currentUser._id.toString()) {%>
                          <a href="/product/deleteProd/<%= product._id %>" class="prod-del-btn">Delete Product</a>
                          <a href="/product/editProd/<%= product._id %>" class="prod-edit-btn">Edit Product</a>
                          <% } %>
    </div>
    
    <% if (product.owner && product.owner.city) { %>
      <div id="map" style="width: 90%; height: 400px; margin: 20px; border-radius: 25px; margin-left: 50px;"></div>

      <script>
        async function initMap() {
          const address = "<%= product.owner.street || '' %>, <%= product.owner.city || '' %>, <%= product.owner.state || '' %>, <%= product.owner.country || '' %> <%= product.owner.pincode || '' %>";

          const response = await fetch(
            `https://maps.googleapis.com/maps/api/geocode/json?address=${encodeURIComponent(address)}&key=<%= googleMapsApiKey %>`
          );

          const data = await response.json();

          if (data.status === "OK") {
            const location = data.results[0].geometry.location;
            const map = new google.maps.Map(document.getElementById("map"), {
              zoom: 14,
              center: location,
            });

            new google.maps.Marker({
              position: location,
              map: map,
              title: "Seller Location",
            });
          } else {
            console.error("Geocoding failed:", data.status);
          }
        }
      </script>

      <script async defer
        src="https://maps.googleapis.com/maps/api/js?key=<%= googleMapsApiKey %>&callback=initMap"></script>

      <% } %>

  </div>
</div>